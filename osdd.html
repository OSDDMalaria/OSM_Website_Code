<html>

<head>
    <title>OSDD - Open Source Drug Delivery - Malaria</title>
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <script type="text/javascript" src="bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="jquery-1.10.1.min.js"></script>

    <style type="text/css">
        #twitter-feedxxx {
            margin-left: 40%;
            margin-right: 40%;
            color: purple;
            background-color: #d8daff
        }

        #github-feedxxx {
            margin-left: 30%;
            margin-right: 10%;
            color: black;
        }

        .open {
            background-image: url("http://placehold.it/50x20/25e01b/000000&text=OPEN");
            background-repeat: no-repeat;
        }

        .closed {
            background-image: url("http://placehold.it/50x20/ed216c/000000&text=CLOSED");
            background-repeat: no-repeat;
        }

        .comment {
            background-image: url("http://placehold.it/50x20/edea21/000000&text=COMMENT");
            background-repeat: no-repeat;
        }

        .logo {
            height: 25px;
        }

        .gray {
            color: gray;
        }

        .title {
            margin-left: 60px;
        }

        .makespace{
            margin-top: 20px;
        }

        .indented {
            margin-left: 5%;
            color: blue;
            background-color: #ffffff;
            text-wrap:normal;
            overflow-wrap:break-word;
        }

    </style>

    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

    <script>
        $(document).ready(function () {
            loadLatestTweets();
            loadLatestGithubIssues();
            loadTeam();
            loadSponsors();
        });

        //Twitter Parsers
        String.prototype.parseURL = function () {
            return this.replace(/[A-Za-z]+:\/\/[A-Za-z0-9-_]+\.[A-Za-z0-9-_:%&~\?\/.=]+/g, function (url) {
                return url.link(url);
            });
        };

        String.prototype.parseUsername = function () {
            return this.replace(/[@]+[A-Za-z0-9-_]+/g, function (u) {
                var username = u.replace("@", "")
                return u.link("http://twitter.com/" + username);
            });
        };

        String.prototype.parseHashtag = function () {
            return this.replace(/[#]+[A-Za-z0-9-_]+/g, function (t) {
                var tag = t.replace("#", "%23")
                return t.link("http://search.twitter.com/search?q=" + tag);
            });
        };

        function parseDate(str) {
            var v = str.split(' ');
            return new Date(Date.parse(v[1] + " " + v[2] + ", " + v[5] + " " + v[3] + " UTC"));
        }

        function loadLatestTweets() {
            var numTweets = 5;
            var _url = 'https://api.twitter.com/1/statuses/user_timeline/osdd.json?callback=?&count=' + numTweets + '&include_rts=1';
            $.getJSON(_url, function (data) {
                for (var i = 0; i < data.length; i++) {
                    var tweet = data[i].text;
                    var created = parseDate(data[i].created_at);
                    var hours = created.getHours().toString();
                    if (hours.length == 1) hours = '0' + hours;
                    var minutes = created.getMinutes().toString();
                    if (minutes.length == 1) minutes = '0' + minutes;

                    var createdDate = created.getDate() + '-' + (created.getMonth() + 1) + '-' + created.getFullYear() + ' at ' + hours + ':' + minutes;
                    tweet = tweet.parseURL().parseUsername().parseHashtag();
                    tweet += '<div class="tweeter-info"><div class="uppercase bold"></div><div class="right"><a href="https://twitter.com/#!/osdd/status/' + data[i].id_str + '">' + createdDate + '</a></div></div>'
                    $("#twitter-feed").append('<p>' + tweet + '</p>');
                }
            });
        }

        function loadTeam() {

            $.getJSON("https://api.github.com/repos/chuckfitzpatricksf/OSDD_test/issues", function (data) {
                var perRow = 5;
                var rowPosition = 0;
                var numTeamMembers = 100;
                var data_index = -1;

                for (i=0; i<data.length; i++) {
                    if (data[i].title == "team") data_index = i;
                }

                if (data_index > -1) {
                    team_members = $.parseJSON(data[data_index].body);
                    var lastTeamMember = Math.min(numTeamMembers, team_members.length);

                    for (var i = 0; i < lastTeamMember; i++) {
                        name = team_members[i].name || "No name" ;
                        url = team_members[i].url;
                        if (team_members[i].letters) {
                            letters = ", " + team_members[i].letters;
                        } else {
                            letters = "";
                        }

                        if (rowPosition == 0) { // starting a new row
                            $("#team_members").append('<div class="row-fluid">');
                        }

                        var team_member;
                        if (url) {
                            team_member = '<span class="span2"><a href="http:\\' + url + '" target="_blank" style="text-decoration: none;"> ' + name + letters + '</a></span>'
                        } else
                        {
                            team_member = '<span class="span2">' + name + letters + '</span>'
                        }
                        $("#team_members").append(team_member);
                        rowPosition++;
                        if (rowPosition >= perRow) {
                            console.log("new row");
                            $("#team_members").append('</div>');
                            rowPosition = 0;
                        }
                    }
                }
            })
        }

        function loadSponsors() {
            $.getJSON("https://api.github.com/repos/chuckfitzpatricksf/OSDD_test/issues", function (data) {
                var perRow = 4;
                var rowPosition = 0;
                var numSponsors = 100;
                var currentRow = 0;
                var data_index = -1;

                for (i=0; i<data.length; i++) {
                    if (data[i].title == "sponsors") data_index = i;
                }

                if (data_index > -1) {
                    sponsors = $.parseJSON(data[data_index].body);
                    var lastSponsor = Math.min(numSponsors, sponsors.length);

                    for (var i = 0; i < lastSponsor; i++) {
                        var name = sponsors[i].name;
                        var url = sponsors[i].url;
                        var image = sponsors[i].image;


                        if (rowPosition == 0) { // starting a new row
                            $("#sponsors").append('<div class="row-fluid makespace" id="sponsorRow' + currentRow + '">');
                        }

                        var sponsor;
                        if (url) {
                            sponsor ='<span class="span3"><a href="http:\\' + url + '" target="_blank"><img src="https:\\' + image + '"></a></span>'
                        } else {
                            sponsor ='<span class="span3"><img src="https:\\' + image + '"></span>'
                        }

                        $("#sponsorRow" + currentRow).append(sponsor);
                        rowPosition++;
                        if (rowPosition >= perRow) {
                            $("#sponsorRow" + currentRow).append('</div>');
                            rowPosition = 0;
                            currentRow++;
                        }
                    }
                }
            });
        }

        function loadLatestGithubIssues() {

            $.getJSON("https://api.github.com/repos/OSDDMalaria/OSDDMalaria_To_Do_List/issues", function (data) {
                var numGithubItems = 3;
                var lastGithubItem = Math.min(numGithubItems, data.length);
                for (var i = 0; i < lastGithubItem; i++) {
                    var item_title = data[i].title;
                    var item_body = data[i].body;

                    $("#github-feed").append('<span class=' + data[i].state + '><span class=title>' + item_title + '</span></span>');
                    $("#github-feed").append('<div class=indented>' + item_body + '</div>');
                }
            })
        }

    </script>
</head>
<body>
    <div class="container">
        <div id="content" class="row-fluid">
            <span class="span5">
                <img class="logo" src="OSDD_Logo.png"></img>
                <span><strong>OSDD</strong></span><span class="gray">Malaria</span>
            </span>
            <div class="span4">

            </div>
            <div class="span3">
                <a href="https://plus.google.com/u/0/b/114702323662314783325/114702323662314783325/posts" target="_blank" style="text-decoration: none;"><img src="https://ssl.gstatic.com/images/icons/gplus-32.png" width="15px" height="15px" style="border: 0;"></a>
                <a href="http://facebook.com/OSDDforMalaria" target="_blank"><img src="facebook_square.png" width="23px" height="23px" title="OSDDMalaria" border="0" /></a>
                <a href="https://twitter.com/OSDDMalaria" target = "_blank"><img src="twitter-bird-white-on-blue.png" width="15px" height="15px"></a>
            </div>

        </div>

        <div id="content" class="row-fluid">
            <div class="span8">
                <h3>Looking for new medicines for Malaria</h3>
                <div> We are a collective of people interested in conducting experiments that get us closer to a cure.</div>
            </div>
            <div class="span4 main">
                <h2>Twitter Activity</h2>
            </div>
        </div>

        <div id="content" class="row-fluid">
            <div class="span3">
                <h3>Lab Notebook</h3>
                <div>View raw research data</div>
                <a href="http://malaria.ourexperiment.org/" target="_blank"><img src="lab_notebook.jpeg"></a>
            </div>
            <div class="span4">
                <h2 style="display: inline">Project Activity</h2>
                <a href="http://github.com/OSDDMalaria/OSDDMalaria_To_Do_List/issues?page=1" target="_blank">Go There</a>
                <div id="github-container">
                    <div id="github-feed"></div>
                </div>
                </ul>
            </div>
            <div class="span1"></div>
            <div class="span4">
                <div id="twitter-feed"></div>
            </div>
        </div>

        <div class="row-fluid">
            <h3>Meet the Team</h3>
        </div>
        <div id="team_members"></div>

        <div class="row-fluid makespace"></div>
        <hr>
        <div class="row-fluid">
            <span class="span3">
                <a href="#" target="_blank">Join The Team</a></li>
            </span>

            <span class="span3">
                <a href="http://openwetware.org/wiki/Open_Source_Drug_Discovery_-_Malaria" target="_blank">View The Wiki</a></li>
            </span>

            <span class="span3">
                <a href=" http://www.thesynapticleap.org/malaria/community" target="_blank">Start Your Own Project</a>
            </span>

        </div>

        <div class="row-fluid">
            <h3>Many thanks to our friends and supporters</h3>
        </div>
        <div id="sponsors"></div>


    </div>
</body>
</html>